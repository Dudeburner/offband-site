<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connect · Offband</title>
  <meta name="description" content="Connect with Offband and reach us securely (with optional PGP encryption)." />
  <link rel="stylesheet" href="/assets/site.css" />
  <script defer src="/assets/include.js"></script>
  <script defer src="/assets/sidebar.js"></script>
</head>
<body class="has-hero">
  <div data-include="/components/topbar.html"></div>

  <div class="layout">
    <aside id="sidebar" data-include="/components/sidebar.html"></aside>

    <main id="content" class="content">
      <section class="card hero">
        <h1 class="brandmark">
          <img class="logo-badge" src="/assets/logo-badge.svg" alt="" aria-hidden="true" />
          <span class="brand-name">Connect with Offband</span>
        </h1>
        <p class="lede">
          Offband is a security‑first, community‑driven sandbox: homelab notes,
          repeatable setups, and small tools — built in public.
        </p>
      </section>

      <section class="feature-grid grid-2">
        <article class="card">
          <h3>Connect & keys</h3>
          <ul class="list-tight">
            <li>General: <a href="mailto:contact@offband.dev">contact@offband.dev</a></li>
            <li>Security: <a href="mailto:security@offband.dev">security@offband.dev</a></li>
          </ul>
          <p class="muted">
            Prefer encryption? Use the PGP widget below or fetch our key (and fingerprint) in
            <a href="/.well-known/security.txt">security.txt</a> or directly at
            <a href="/keys/offband.asc">keys/offband.asc</a>. For responsible disclosures, please see our
            <a href="/security/">Security</a> page.
          </p>
        </article>

	  <section class="card" id="pgp-widget">
	    <h3>Encrypt a message</h3>
	    <p class="muted">Browser‑side PGP. Nothing leaves your machine until you send it.</p>

        <label for="pgp-recipient">Recipient</label>
        <select id="pgp-recipient">
          <option value="contact@offband.dev">contact@offband.dev</option>
          <option value="security@offband.dev">security@offband.dev</option>
        </select>

        <label for="pgp-plain">Message</label>
        <textarea id="pgp-plain" rows="12" style="width:100%;box-sizing:border-box;" placeholder="Write your message…"></textarea>

	    <div class="actions" style="margin: 8px 0;">
	      <button class="btn btn--primary" id="pgp-encrypt" type="button">Encrypt</button>
	      <button class="btn" id="pgp-copy" type="button">Copy</button>
	      <button class="btn" id="pgp-download" type="button">Download</button>
	      <a class="btn" id="pgp-email" href="#">Open in email</a>
	    </div>

        <label for="pgp-armored">Encrypted (ASCII‑armored)</label>
        <textarea id="pgp-armored" rows="16" style="width:100%;box-sizing:border-box;font-family:monospace;" readonly placeholder="-----BEGIN PGP MESSAGE-----"></textarea>
	  </section>

      <footer data-include="/components/footer.html"></footer>
    </main>
  </div>
<!-- OpenPGP loader: prefer local, fallback to CDN -->
<script>
(function(){
  // Prefer a locally hosted, pinned version; fall back to CDN if missing
  var LOCAL_SRC = '/assets/vendor/openpgp-5.11.1.min.js';
  var CDN_SRC    = 'https://unpkg.com/openpgp@5.11.1/dist/openpgp.min.js';
  var loaded = false;

  function inject(src, attrs, onload, onerror){
    var s = document.createElement('script');
    s.src = src; s.defer = true;
    if (attrs) for (var k in attrs) s.setAttribute(k, attrs[k]);
    s.onload = onload; s.onerror = onerror;
    document.head.appendChild(s);
  }

  function onReady(){
    loaded = true;
    var enc = document.getElementById('pgp-encrypt');
    if (window.openpgp && enc) enc.disabled = false;
    try { window.dispatchEvent(new Event('openpgp:ready')); } catch (e) {}
  }
  function onFail(){ if (!loaded) inject(CDN_SRC, {referrerpolicy:'no-referrer'}, onReady, function(){ /* both failed */ }); }

  // 1) Try local pinned asset first
  inject(LOCAL_SRC, null, onReady, onFail);

  // 2) Guard: if lib didn’t load in time, disable Encrypt to avoid false sense of security
  setTimeout(function(){
    if (!window.openpgp) {
      var enc = document.getElementById('pgp-encrypt');
      if (enc) enc.disabled = true;
      console.warn('[connect] OpenPGP library failed to load; encryption disabled.');
    }
  }, 3000);
})();
</script>
<!-- Standardized widget that wires Encrypt/Copy/Download/Email -->
<script defer src="/assets/pgp-widget.js"></script>
</body>
</html>
