<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Offband — Home</title>
  <meta name="description" content="Hands-on security notes and small operator tools. Built in public." />
  <link rel="preload" href="/assets/site.css" as="style">
  <link rel="stylesheet" href="/assets/site.css" />
  <script defer src="/assets/include.js"></script>
  <script defer src="/assets/sidebar.js"></script>
</head>
<body id="home" class="has-hero">
  <div data-include="/components/topbar.html"></div>

  <div class="layout">
    <!-- Sidebar (component include) -->
    <aside id="sidebar" data-include="/components/sidebar.html"></aside>

    <!-- Content view -->
    <main id="content" class="content">

      <!-- Brand + mission -->
      <section class="hero hero--center">
        <div class="hero__brandmark">
          <h1 class="brandmark">
            <img class="brand-logo" src="/assets/logo-badge.svg" alt="" width="96" height="96" aria-hidden="true" />
            <span class="brand-name">Offband</span>
          </h1>
        </div>

        <p class="lede">
          Hands‑on security notes and small operator tools. Built in public.
        </p>
        <p class="subtle">
          Homelab hardening, OSINT workflows, and repeatable setups you can
          clone, adapt, and ship.
        </p>

        <div class="hero__actions">
          <a class="btn btn--primary" href="/writeups/">Read writeups</a>
          <a class="btn" href="/security/">See dashboard</a>
        </div>
      </section>

      <!-- Featured: latest writeup + latest log -->
      <section id="featured" class="card featured" aria-label="Recent activity">
        <h2 class="h3">Latest from the lab</h2>
        <ul id="featured-list" class="featured-list">
          <li class="muted">Loading recent activity…</li>
        </ul>
      </section>

      <script>
      (async function () {
        const list = document.getElementById('featured-list');
        if (!list) return;

        async function latestItem(indexUrl, requiredPrefix, fallbackLabel) {
          try {
            const res = await fetch(indexUrl, { headers: { 'Accept': 'text/html' } });
            if (!res.ok) throw new Error('fetch failed');
            const html = await res.text();
            const doc = new DOMParser().parseFromString(html, 'text/html');
            // Try common list wrappers first, then fall back to any anchors
            const candidates = Array.from(doc.querySelectorAll(
              'main a, .list a, .posts a, .post-list a, .logs a, .logs-list a, a'
            ));
            const internal = candidates.filter(a => {
              const href = a.getAttribute('href') || '';
              return href.startsWith(requiredPrefix);
            });
            const first = internal[0];
            if (first) {
              const href = first.getAttribute('href');
              const title = (first.textContent || '').trim() || fallbackLabel;
              return { href, title, label: fallbackLabel };
            }
          } catch (_) {}
          return null;
        }

        const [post, log] = await Promise.all([
          latestItem('/writeups/posts/index.html', '/writeups/posts/', 'Writeup'),
          latestItem('/security/logs/index.html', '/security/logs/', 'Security log')
        ]);

        list.innerHTML = '';
        const items = [post, log].filter(Boolean);
        if (items.length === 0) {
          list.innerHTML = '<li class="muted">No recent items yet.</li>';
          return;
        }

        for (const it of items) {
          const li = document.createElement('li');
          li.innerHTML = `<a class="link" href="${it.href}">${it.title}</a> <span class="tag">${it.label}</span>`;
          list.appendChild(li);
        }
      })();
      </script>

      <!-- Community / Get involved -->
      <section class="card callout">
        <h2>Community</h2>
        <p>
          Want to help test, report bugs, or try challenges? Start with the
          security overview for legal/ethical testing and reporting steps.
        </p>
        <a class="btn" href="/security/">Get involved</a>
      </section>

      <!-- Footer (component include) -->
      <footer data-include="/components/footer.html"></footer>
    </main>
  </div>
</body>
</html>
